<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AgriShield AI | Smart Crop Diagnosis</title>
    <!-- Tailwind CSS for modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- jsPDF for Report Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
      body {
        font-family: "Poppins", sans-serif;
        min-height: 100vh;
        margin: 0;
        position: relative; /* Required for the pseudo-element to align correctly */
      }

      body::before {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1; /* Ensures the background stays behind your text */

        /* Your Image Details */
        background: url("https://images.unsplash.com/photo-1523348837708-15d4a09cfac2?auto=format&fit=crop&w=1920&q=80")
          no-repeat center center;
        background-size: cover;

        /* Opacity Setting */
        opacity: 0.5;
      }

      .glass-panel {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
      }

      .gradient-text {
        background: linear-gradient(90deg, #166534, #15803d);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .upload-area {
        border: 2px dashed #166534;
        transition: all 0.3s ease;
      }

      .upload-area:hover {
        background: rgba(22, 101, 52, 0.05);
        border-color: #15803d;
      }

      .loading-spinner {
        border: 4px solid rgba(0, 0, 0, 0.1);
        width: 36px;
        height: 36px;
        border-radius: 50%;
        border-left-color: #166534;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      #result-content h1,
      #result-content h2,
      #result-content h3 {
        font-weight: bold;
        color: #166534;
        margin-top: 1rem;
      }
      #result-content ul {
        list-style-type: disc;
        margin-left: 1.5rem;
      }

      #footer-text {
        font-weight: bolder;
        font-size: large;
      }
    </style>
  </head>
  <body class="p-4 md:p-8">
    <div class="max-w-4xl mx-auto">
      <!-- Header Section -->
      <header
        class="glass-panel rounded-2xl p-6 mb-8 flex flex-col md:flex-row justify-between items-center gap-4"
      >
        <div class="flex items-center gap-3">
          <i data-lucide="sprout" class="text-green-700 w-10 h-10"></i>
          <h1 class="text-3xl font-bold gradient-text" id="site-title">
            AgriShield AI
          </h1>
        </div>
        <div class="flex flex-wrap items-center gap-4">
          <div class="relative">
            <select
              id="lang-selector"
              class="bg-white border border-green-200 rounded-lg px-4 py-2 outline-none focus:ring-2 focus:ring-green-500 cursor-pointer"
            >
              <option value="en">English</option>
              <option value="hi">‡§π‡§ø‡§Ç‡§¶‡•Ä (Hindi)</option>
              <option value="pa">‡®™‡©∞‡®ú‡®æ‡®¨‡©Ä (Punjabi)</option>
              <option value="ta">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç (Tamil)</option>
              <option value="te">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å (Telugu)</option>
              <option value="bn">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ (Bengali)</option>
              <option value="mr">‡§Æ‡§∞‡§æ‡§†‡•Ä (Marathi)</option>
              <option value="kn">‡≤ï‡≤®‡≥ç‡≤®‡≤° (Kannada)</option>
              <option value="gu">‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä (Gujarati)</option>
            </select>
          </div>
          <button
            id="location-btn"
            class="flex items-center gap-2 bg-green-700 hover:bg-green-800 text-white px-4 py-2 rounded-lg transition shadow-md"
          >
            <i data-lucide="map-pin" class="w-4 h-4"></i>
            <span id="loc-text">Detect Location</span>
          </button>
        </div>
      </header>

      <!-- Main Content Section -->
      <main
        id="main-card"
        class="glass-panel rounded-3xl p-8 transition-all duration-500"
      >
        <!-- Form View -->
        <div id="form-view">
          <div class="mb-8 text-center">
            <h2
              class="text-2xl font-semibold text-gray-800 mb-2"
              id="form-heading"
            >
              Crop Health Diagnostic
            </h2>
            <p class="text-gray-600" id="form-subheading">
              Upload an image and provide details for an AI-powered organic
              solution.
            </p>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <div class="space-y-4">
              <div>
                <label
                  class="block text-sm font-medium text-gray-700 mb-1"
                  id="lbl-crop-name"
                  >Crop Name</label
                >
                <input
                  type="text"
                  id="crop-name"
                  placeholder="e.g. Tomato, Wheat, Rice"
                  class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-green-500 outline-none"
                />
              </div>
              <div>
                <label
                  class="block text-sm font-medium text-gray-700 mb-1"
                  id="lbl-symptoms"
                  >Observed Symptoms</label
                >
                <textarea
                  id="symptoms"
                  rows="3"
                  placeholder="e.g. yellow spots, wilting leaves"
                  class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-green-500 outline-none"
                ></textarea>
              </div>
              <div
                id="location-info"
                class="hidden text-xs text-green-700 font-medium"
              >
                üìç Location captured successfully
              </div>
            </div>

            <div class="flex flex-col">
              <label
                class="block text-sm font-medium text-gray-700 mb-1"
                id="lbl-image"
                >Upload Crop Image</label
              >
              <div
                class="upload-area flex-1 rounded-2xl flex flex-col items-center justify-center p-6 cursor-pointer relative overflow-hidden"
                onclick="document.getElementById('image-input').click()"
              >
                <input
                  type="file"
                  id="image-input"
                  accept="image/*"
                  class="hidden"
                />
                <div id="upload-placeholder" class="text-center">
                  <i
                    data-lucide="image-plus"
                    class="w-12 h-12 text-green-600 mx-auto mb-2"
                  ></i>
                  <p class="text-sm text-gray-500" id="upload-text">
                    Click to capture or select photo
                  </p>
                </div>
                <img
                  id="image-preview"
                  class="hidden absolute inset-0 w-full h-full object-cover rounded-2xl"
                />
              </div>
            </div>
          </div>

          <button
            id="analyze-btn"
            class="w-full bg-green-700 hover:bg-green-800 text-white font-bold py-4 rounded-xl text-lg shadow-lg flex items-center justify-center gap-3 transition"
          >
            <span id="btn-text">Start AI Diagnosis</span>
            <i data-lucide="arrow-right" class="w-5 h-5"></i>
          </button>
        </div>

        <!-- Loading View -->
        <div
          id="loading-view"
          class="hidden flex flex-col items-center justify-center py-20"
        >
          <div class="loading-spinner mb-4"></div>
          <p class="text-xl font-semibold text-green-800" id="loading-msg">
            Analyzing Crop Image & Data...
          </p>
          <p class="text-gray-500 text-sm" id="loading-sub">
            Consulting agricultural database...
          </p>
        </div>

        <!-- Result View -->
        <div id="result-view" class="hidden">
          <div
            class="flex justify-between items-start mb-6 border-b border-green-100 pb-4"
          >
            <div>
              <h2 class="text-2xl font-bold text-green-800" id="result-title">
                Diagnosis Report
              </h2>
              <p class="text-sm text-gray-500" id="result-timestamp"></p>
            </div>
            <div class="flex gap-2">
              <button
                id="download-btn"
                class="p-2 bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 transition"
                title="Download PDF"
              >
                <i data-lucide="download" class="w-5 h-5"></i>
              </button>
              <button
                id="new-analysis-btn"
                class="p-2 bg-green-50 text-green-700 rounded-lg hover:bg-green-100 transition"
                title="New Analysis"
              >
                <i data-lucide="refresh-cw" class="w-5 h-5"></i>
              </button>
            </div>
          </div>

          <div
            id="result-content"
            class="prose max-w-none text-gray-700 space-y-4"
          >
            <!-- AI Result injected here -->
          </div>
        </div>
      </main>

      <footer
        class="mt-8 text-center text-black text-sm opacity-100"
        id="footer-text"
      >
        ¬© 2026 AgriShield AI - Empowering Farmers with Organic Solutions
      </footer>
    </div>

    <script>
      // API Configuration (Corrected for Gemini 2.5 Flash)
      const apiKey = "ENTER_API_KEY"; // Provided by user
      const MODEL_NAME = "ENTER_MODEL_NAME";

      const translations = {
        en: {
          title: "AgriShield AI",
          detectLoc: "Detect Location",
          formHeading: "Crop Health Diagnostic",
          formSub:
            "Upload an image and provide details for an AI-powered organic solution.",
          cropLabel: "Crop Name",
          symptomLabel: "Observed Symptoms",
          imageLabel: "Upload Crop Image",
          uploadText: "Click to capture or select photo",
          btnStart: "Start AI Diagnosis",
          loading: "Analyzing Crop Image & Data...",
          loadingSub: "Consulting agricultural database...",
          reportTitle: "Diagnosis Report",
          footer:
            "¬© 2026 AgriShield AI - Empowering Farmers with Organic Solutions",
          locSuccess: "üìç Location captured successfully",
        },
        hi: {
          title: "‡§è‡§ó‡•ç‡§∞‡•Ä‡§∂‡•Ä‡§≤‡•ç‡§° AI",
          detectLoc: "‡§∏‡•ç‡§•‡§æ‡§® ‡§ï‡§æ ‡§™‡§§‡§æ ‡§≤‡§ó‡§æ‡§è‡§Ç",
          formHeading: "‡§´‡§∏‡§≤ ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§®‡§ø‡§¶‡§æ‡§®",
          formSub:
            "‡§è‡§ï ‡§§‡§∏‡•ç‡§µ‡•Ä‡§∞ ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§ú‡•à‡§µ‡§ø‡§ï ‡§∏‡§Æ‡§æ‡§ß‡§æ‡§® ‡§ï‡•á ‡§≤‡§ø‡§è ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡§∞‡•á‡§Ç‡•§",
          cropLabel: "‡§´‡§∏‡§≤ ‡§ï‡§æ ‡§®‡§æ‡§Æ",
          symptomLabel: "‡§¶‡•á‡§ñ‡•á ‡§ó‡§è ‡§≤‡§ï‡•ç‡§∑‡§£",
          imageLabel: "‡§´‡§∏‡§≤ ‡§ï‡•Ä ‡§§‡§∏‡•ç‡§µ‡•Ä‡§∞ ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç",
          uploadText: "‡§§‡§∏‡•ç‡§µ‡•Ä‡§∞ ‡§≤‡•á‡§®‡•á ‡§Ø‡§æ ‡§ö‡•Å‡§®‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç",
          btnStart: "AI ‡§®‡§ø‡§¶‡§æ‡§® ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç",
          loading: "‡§´‡§∏‡§≤ ‡§ï‡•Ä ‡§õ‡§µ‡§ø ‡§î‡§∞ ‡§°‡•á‡§ü‡§æ ‡§ï‡§æ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§ï‡§∞ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç...",
          loadingSub: "‡§ï‡•É‡§∑‡§ø ‡§°‡•á‡§ü‡§æ‡§¨‡•á‡§∏ ‡§∏‡•á ‡§™‡§∞‡§æ‡§Æ‡§∞‡•ç‡§∂ ‡§ï‡§∞ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç...",
          reportTitle: "‡§®‡§ø‡§¶‡§æ‡§® ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü",
          footer:
            "¬© 2026 ‡§è‡§ó‡•ç‡§∞‡•Ä‡§∂‡•Ä‡§≤‡•ç‡§° AI - ‡§ï‡§ø‡§∏‡§æ‡§®‡•ã‡§Ç ‡§ï‡•ã ‡§ú‡•à‡§µ‡§ø‡§ï ‡§∏‡§Æ‡§æ‡§ß‡§æ‡§®‡•ã‡§Ç ‡§ï‡•á ‡§∏‡§æ‡§• ‡§∏‡§∂‡§ï‡•ç‡§§ ‡§¨‡§®‡§æ‡§®‡§æ",
          locSuccess: "üìç ‡§∏‡•ç‡§•‡§æ‡§® ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ",
        },
        pa: {
          title: "‡®ê‡®ó‡®∞‡©Ä‡®∏‡®º‡©Ä‡®≤‡®° AI",
          detectLoc: "‡®ü‡®ø‡®ï‡®æ‡®£‡®æ ‡®≤‡©±‡®≠‡©ã",
          formHeading: "‡®´‡®∏‡®≤ ‡®∏‡®ø‡®π‡®§ ‡®ú‡®æ‡®Ç‡®ö",
          formSub: "‡®ú‡©à‡®µ‡®ø‡®ï ‡®π‡©±‡®≤ ‡®≤‡®à ‡®á‡©±‡®ï ‡®§‡®∏‡®µ‡©Ä‡®∞ ‡®Ö‡®™‡®≤‡©ã‡®° ‡®ï‡®∞‡©ã ‡®Ö‡®§‡©á ‡®µ‡©á‡®∞‡®µ‡©á ‡®¶‡®ø‡®ì‡•§",
          cropLabel: "‡®´‡®∏‡®≤ ‡®¶‡®æ ‡®®‡®æ‡®Æ",
          symptomLabel: "‡®¶‡©á‡®ñ‡©á ‡®ó‡®è ‡®≤‡©±‡®õ‡®£",
          imageLabel: "‡®´‡®∏‡®≤ ‡®¶‡©Ä ‡®§‡®∏‡®µ‡©Ä‡®∞ ‡®Ö‡®™‡®≤‡©ã‡®° ‡®ï‡®∞‡©ã",
          uploadText: "‡®§‡®∏‡®µ‡©Ä‡®∞ ‡®≤‡©à‡®£ ‡®ú‡®æ‡®Ç ‡®ö‡©Å‡®£‡®® ‡®≤‡®à ‡®ï‡®≤‡®ø‡©±‡®ï ‡®ï‡®∞‡©ã",
          btnStart: "AI ‡®ú‡®æ‡®Ç‡®ö ‡®∏‡®º‡©Å‡®∞‡©Ç ‡®ï‡®∞‡©ã",
          loading: "‡®´‡®∏‡®≤ ‡®¶‡©Ä ‡®§‡®∏‡®µ‡©Ä‡®∞ ‡®¶‡®æ ‡®µ‡®ø‡®∏‡®º‡®≤‡©á‡®∏‡®º‡®£ ‡®ï‡©Ä‡®§‡®æ ‡®ú‡®æ ‡®∞‡®ø‡®π‡®æ ‡®π‡©à...",
          loadingSub: "‡®ñ‡©á‡®§‡©Ä‡®¨‡®æ‡©ú‡©Ä ‡®°‡©á‡®ü‡®æ‡®¨‡©á‡®∏ ‡®®‡®æ‡®≤ ‡®∏‡®≤‡®æ‡®π ‡®ï‡©Ä‡®§‡©Ä ‡®ú‡®æ ‡®∞‡®π‡©Ä ‡®π‡©à...",
          reportTitle: "‡®ú‡®æ‡®Ç‡®ö ‡®∞‡®ø‡®™‡©ã‡®∞‡®ü",
          footer: "¬© 2026 ‡®ê‡®ó‡®∞‡©Ä‡®∏‡®º‡©Ä‡®≤‡®° AI",
          locSuccess: "üìç ‡®ü‡®ø‡®ï‡®æ‡®£‡®æ ‡®∏‡®´‡®≤‡®§‡®æ‡®™‡©Ç‡®∞‡®µ‡®ï ‡®Æ‡®ø‡®≤ ‡®ó‡®ø‡®Ü",
        },
        ta: {
          title: "‡ÆÖ‡Æï‡Øç‡Æ∞‡Æø‡Æ∑‡ØÄ‡Æ≤‡Øç‡Æü‡Øç AI",
          detectLoc: "‡Æá‡Æ∞‡ØÅ‡Æ™‡Øç‡Æ™‡Æø‡Æü‡Æ§‡Øç‡Æ§‡Øà‡Æï‡Øç ‡Æï‡Æ£‡Øç‡Æü‡Æ±‡Æø",
          formHeading: "‡Æ™‡ÆØ‡Æø‡Æ∞‡Øç ‡ÆÜ‡Æ∞‡Øã‡Æï‡Øç‡Æï‡Æø‡ÆØ ‡Æï‡Æ£‡Øç‡Æü‡Æ±‡Æø‡Æ§‡Æ≤‡Øç",
          formSub: "‡Æ™‡ÆØ‡Æø‡Æ∞‡Øç ‡Æ™‡Æü‡Æ§‡Øç‡Æ§‡Øà ‡Æ™‡Æ§‡Æø‡Æµ‡Øá‡Æ±‡Øç‡Æ±‡Æø ‡Æµ‡Æø‡Æµ‡Æ∞‡Æô‡Øç‡Æï‡Æ≥‡Øà ‡Æµ‡Æ¥‡Æô‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç.",
          cropLabel: "‡Æ™‡ÆØ‡Æø‡Æ∞‡Æø‡Æ©‡Øç ‡Æ™‡ØÜ‡ÆØ‡Æ∞‡Øç",
          symptomLabel: "‡Æï‡Æ£‡Øç‡Æü‡Æ±‡Æø‡ÆØ‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü ‡ÆÖ‡Æ±‡Æø‡Æï‡ØÅ‡Æ±‡Æø‡Æï‡Æ≥‡Øç",
          imageLabel: "‡Æ™‡ÆØ‡Æø‡Æ∞‡Øç ‡Æ™‡Æü‡Æ§‡Øç‡Æ§‡Øà ‡Æ™‡Æ§‡Æø‡Æµ‡Øá‡Æ±‡Øç‡Æ±‡Æµ‡ØÅ‡ÆÆ‡Øç",
          uploadText: "‡Æ™‡ØÅ‡Æï‡Øà‡Æ™‡Øç‡Æ™‡Æü‡ÆÆ‡Øç ‡Æé‡Æü‡ØÅ‡Æï‡Øç‡Æï ‡ÆÖ‡Æ≤‡Øç‡Æ≤‡Æ§‡ØÅ ‡Æ§‡Øá‡Æ∞‡Øç‡Æ®‡Øç‡Æ§‡ØÜ‡Æü‡ØÅ‡Æï‡Øç‡Æï ‡Æï‡Æø‡Æ≥‡Æø‡Æï‡Øç ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡Æµ‡ØÅ‡ÆÆ‡Øç",
          btnStart: "AI ‡Æï‡Æ£‡Øç‡Æü‡Æ±‡Æø‡Æ§‡Æ≤‡Øà‡Æ§‡Øç ‡Æ§‡Øä‡Æü‡Æô‡Øç‡Æï‡ØÅ",
          loading: "‡Æ™‡ÆØ‡Æø‡Æ∞‡Øç ‡Æ™‡Æü‡ÆÆ‡Øç ‡Æ™‡Æï‡ØÅ‡Æ™‡Øç‡Æ™‡Ææ‡ÆØ‡Øç‡Æµ‡ØÅ ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡Æ™‡Øç‡Æ™‡Æü‡ØÅ‡Æï‡Æø‡Æ±‡Æ§‡ØÅ...",
          loadingSub: "‡Æµ‡Æø‡Æµ‡Æö‡Ææ‡ÆØ ‡Æ§‡Æ∞‡Æµ‡ØÅ‡Æ§‡Øç‡Æ§‡Æ≥‡Æ§‡Øç‡Æ§‡Øà ‡ÆÜ‡Æ≤‡Øã‡Æö‡Æø‡Æï‡Øç‡Æï‡Æø‡Æ±‡Æ§‡ØÅ...",
          reportTitle: "‡Æï‡Æ£‡Øç‡Æü‡Æ±‡Æø‡ÆØ‡ØÅ‡ÆÆ‡Øç ‡ÆÖ‡Æ±‡Æø‡Æï‡Øç‡Æï‡Øà",
          footer: "¬© 2026 ‡ÆÖ‡Æï‡Øç‡Æ∞‡Æø‡Æ∑‡ØÄ‡Æ≤‡Øç‡Æü‡Øç AI",
          locSuccess: "üìç ‡Æá‡Æ∞‡ØÅ‡Æ™‡Øç‡Æ™‡Æø‡Æü‡ÆÆ‡Øç ‡Æµ‡ØÜ‡Æ±‡Øç‡Æ±‡Æø‡Æï‡Æ∞‡ÆÆ‡Ææ‡Æï ‡Æé‡Æü‡ØÅ‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ",
        },
        te: {
          title: "‡∞Ö‡∞ó‡±ç‡∞∞‡∞ø‡∞∑‡±Ä‡∞≤‡±ç‡∞°‡±ç AI",
          detectLoc: "‡∞∏‡±ç‡∞•‡∞æ‡∞®‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞ó‡±Å‡∞∞‡±ç‡∞§‡∞ø‡∞Ç‡∞ö‡±Å",
          formHeading: "‡∞™‡∞Ç‡∞ü ‡∞Ü‡∞∞‡±ã‡∞ó‡±ç‡∞Ø ‡∞®‡∞ø‡∞∞‡±ç‡∞ß‡∞æ‡∞∞‡∞£",
          formSub: "‡∞Ü‡∞∞‡±ç‡∞ó‡∞æ‡∞®‡∞ø‡∞ï‡±ç ‡∞™‡∞∞‡∞ø‡∞∑‡±ç‡∞ï‡∞æ‡∞∞‡∞Ç ‡∞ï‡±ã‡∞∏‡∞Ç ‡∞™‡∞Ç‡∞ü ‡∞ö‡∞ø‡∞§‡±ç‡∞∞‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞Ö‡∞™‡±ç‚Äå‡∞≤‡±ã‡∞°‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø.",
          cropLabel: "‡∞™‡∞Ç‡∞ü ‡∞™‡±á‡∞∞‡±Å",
          symptomLabel: "‡∞ó‡∞Æ‡∞®‡∞ø‡∞Ç‡∞ö‡∞ø‡∞® ‡∞≤‡∞ï‡±ç‡∞∑‡∞£‡∞æ‡∞≤‡±Å",
          imageLabel: "‡∞™‡∞Ç‡∞ü ‡∞ö‡∞ø‡∞§‡±ç‡∞∞‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞Ö‡∞™‡±ç‚Äå‡∞≤‡±ã‡∞°‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø",
          uploadText: "‡∞´‡±ã‡∞ü‡±ã ‡∞§‡±Ä‡∞Ø‡∞°‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞ï‡±ç‡∞≤‡∞ø‡∞ï‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø",
          btnStart: "AI ‡∞®‡∞ø‡∞∞‡±ç‡∞ß‡∞æ‡∞∞‡∞£ ‡∞™‡±ç‡∞∞‡∞æ‡∞∞‡∞Ç‡∞≠‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø",
          loading: "‡∞™‡∞Ç‡∞ü ‡∞ö‡∞ø‡∞§‡±ç‡∞∞‡∞Ç ‡∞µ‡∞ø‡∞∂‡±ç‡∞≤‡±á‡∞∑‡∞ø‡∞Ç‡∞ö‡∞¨‡∞°‡±Å‡∞§‡±ã‡∞Ç‡∞¶‡∞ø...",
          loadingSub: "‡∞µ‡±ç‡∞Ø‡∞µ‡∞∏‡∞æ‡∞Ø ‡∞°‡±á‡∞ü‡∞æ‡∞¨‡±á‡∞∏‡±ç ‡∞∏‡∞Ç‡∞™‡±ç‡∞∞‡∞¶‡∞ø‡∞∏‡±ç‡∞§‡±ã‡∞Ç‡∞¶‡∞ø...",
          reportTitle: "‡∞®‡∞ø‡∞∞‡±ç‡∞ß‡∞æ‡∞∞‡∞£ ‡∞®‡∞ø‡∞µ‡±á‡∞¶‡∞ø‡∞ï",
          footer: "¬© 2026 ‡∞Ö‡∞ó‡±ç‡∞∞‡∞ø‡∞∑‡±Ä‡∞≤‡±ç‡∞°‡±ç AI",
          locSuccess: "üìç ‡∞∏‡±ç‡∞•‡∞æ‡∞®‡∞Ç ‡∞µ‡∞ø‡∞ú‡∞Ø‡∞µ‡∞Ç‡∞§‡∞Ç‡∞ó‡∞æ ‡∞ó‡±Å‡∞∞‡±ç‡∞§‡∞ø‡∞Ç‡∞ö‡∞¨‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø",
        },
      };

      let currentLang = "en";
      let userLocation = null;
      let base64ImageData = null;

      lucide.createIcons();

      document
        .getElementById("lang-selector")
        .addEventListener("change", (e) => {
          updateLanguage(e.target.value);
        });

      function updateLanguage(lang) {
        currentLang = lang;
        const t = translations[lang] || translations["en"];
        document.getElementById("site-title").innerText = t.title;
        document.getElementById("loc-text").innerText = t.detectLoc;
        document.getElementById("form-heading").innerText = t.formHeading;
        document.getElementById("form-subheading").innerText = t.formSub;
        document.getElementById("lbl-crop-name").innerText = t.cropLabel;
        document.getElementById("lbl-symptoms").innerText = t.symptomLabel;
        document.getElementById("lbl-image").innerText = t.imageLabel;
        document.getElementById("upload-text").innerText = t.uploadText;
        document.getElementById("btn-text").innerText = t.btnStart;
        document.getElementById("loading-msg").innerText = t.loading;
        document.getElementById("loading-sub").innerText = t.loadingSub;
        document.getElementById("result-title").innerText = t.reportTitle;
        document.getElementById("footer-text").innerText = t.footer;
        document
          .getElementById("location-info")
          .querySelector("span").innerText = t.locSuccess;
      }

      document.getElementById("location-btn").addEventListener("click", () => {
        const btn = document.getElementById("location-btn");
        btn.innerHTML =
          '<div class="loading-spinner w-4 h-4 border-green-700 border-2"></div>...';

        if ("geolocation" in navigator) {
          navigator.geolocation.getCurrentPosition(
            (pos) => {
              userLocation = {
                lat: pos.coords.latitude,
                lon: pos.coords.longitude,
              };
              document
                .getElementById("location-info")
                .classList.remove("hidden");
              btn.innerHTML =
                '<i data-lucide="check" class="w-4 h-4"></i> Captured';
              lucide.createIcons();
            },
            () => {
              alert("Location access denied.");
              btn.innerHTML = `<i data-lucide="map-pin" class="w-4 h-4"></i> ${translations[currentLang].detectLoc}`;
              lucide.createIcons();
            },
          );
        }
      });

      document
        .getElementById("image-input")
        .addEventListener("change", function (e) {
          const file = e.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = function (event) {
              base64ImageData = event.target.result.split(",")[1]; // Extract just the base64 data
              const preview = document.getElementById("image-preview");
              preview.src = event.target.result;
              preview.classList.remove("hidden");
              document
                .getElementById("upload-placeholder")
                .classList.add("hidden");
            };
            reader.readAsDataURL(file);
          }
        });

      async function fetchWithRetry(url, options, retries = 5, delay = 1000) {
        for (let i = 0; i < retries; i++) {
          try {
            const response = await fetch(url, options);
            if (response.ok) return await response.json();
            if (response.status === 429 || response.status >= 500) {
              await new Promise((resolve) => setTimeout(resolve, delay));
              delay *= 2;
              continue;
            }
            throw new Error(`API Error: ${response.status}`);
          } catch (err) {
            if (i === retries - 1) throw err;
            await new Promise((resolve) => setTimeout(resolve, delay));
            delay *= 2;
          }
        }
      }

      document
        .getElementById("analyze-btn")
        .addEventListener("click", async () => {
          const cropName = document.getElementById("crop-name").value;
          const symptoms = document.getElementById("symptoms").value;

          if (!base64ImageData) {
            alert("Please upload an image of the crop first.");
            return;
          }

          document.getElementById("form-view").classList.add("hidden");
          document.getElementById("loading-view").classList.remove("hidden");

          const langText =
            document.getElementById("lang-selector").selectedOptions[0].text;

          const prompt = `Act as a professional agricultural scientist. Analyze this crop image.
                Crop: ${cropName || "Unknown"}
                Symptoms: ${symptoms || "None mentioned"}
                Location context: ${userLocation ? `Lat ${userLocation.lat}, Lon ${userLocation.lon}` : "Not provided"}
                
                RESPONSE FORMAT:
                1. Identify the likely disease/pest.
                2. Explain the cause.
                3. Provide 5 ORGANIC solutions in bullet points.
                4. Recommend prevention tips.
                
                LANGUAGE: Respond entirely in ${langText}.
                Use HTML tags like <h3>, <p>, and <ul> <li> for structured formatting.`;

          const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${apiKey}`;

          const payload = {
            contents: [
              {
                parts: [
                  { text: prompt },
                  {
                    inlineData: {
                      mimeType: "image/png",
                      data: base64ImageData,
                    },
                  },
                ],
              },
            ],
          };

          try {
            const data = await fetchWithRetry(apiUrl, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(payload),
            });

            const aiResponse =
              data.candidates?.[0]?.content?.parts?.[0]?.text ||
              "No analysis generated.";

            document.getElementById("loading-view").classList.add("hidden");
            document.getElementById("result-view").classList.remove("hidden");
            document.getElementById("result-content").innerHTML = aiResponse;
            document.getElementById("result-timestamp").innerText =
              "Generated: " + new Date().toLocaleString();
          } catch (error) {
            console.error(error);
            alert("Error: " + error.message);
            document.getElementById("loading-view").classList.add("hidden");
            document.getElementById("form-view").classList.remove("hidden");
          }
        });

      document
        .getElementById("new-analysis-btn")
        .addEventListener("click", () => {
          document.getElementById("result-view").classList.add("hidden");
          document.getElementById("form-view").classList.remove("hidden");
          document.getElementById("crop-name").value = "";
          document.getElementById("symptoms").value = "";
          document.getElementById("image-input").value = "";
          document.getElementById("image-preview").classList.add("hidden");
          document
            .getElementById("upload-placeholder")
            .classList.remove("hidden");
          base64ImageData = null;
        });

      document.getElementById("download-btn").addEventListener("click", () => {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        const content = document.getElementById("result-content").innerText;
        const timestamp = document.getElementById("result-timestamp").innerText;

        doc.setFontSize(20);
        doc.setTextColor(22, 101, 52);
        doc.text("AgriShield AI Diagnosis", 15, 20);

        doc.setFontSize(10);
        doc.setTextColor(100);
        doc.text(timestamp, 15, 30);

        doc.setFontSize(12);
        doc.setTextColor(0);
        const splitText = doc.splitTextToSize(content, 180);
        doc.text(splitText, 15, 45);

        doc.save("AgriShield_Report.pdf");
      });
    </script>
  </body>
</html>
